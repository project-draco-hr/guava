{
  if (unfiltered instanceof FilteredKeyMultimap) {
    FilteredKeyMultimap<K,V> prev=(FilteredKeyMultimap<K,V>)unfiltered;
    return new FilteredKeyMultimap<K,V>(prev.unfiltered,Predicates.and(prev.keyPredicate,keyPredicate));
  }
 else   if (unfiltered instanceof FilteredMultimap) {
    FilteredMultimap<K,V> prev=(FilteredMultimap<K,V>)unfiltered;
    return new FilteredEntryMultimap<K,V>(prev.unfiltered,Predicates.<Entry<K,V>>and(prev.entryPredicate(),Predicates.compose(keyPredicate,Maps.<K>keyFunction())));
  }
 else {
    return new FilteredKeyMultimap<K,V>(unfiltered,keyPredicate);
  }
}
