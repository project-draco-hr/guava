{
  checkNotNull(from);
  checkNotNull(to);
  int successfulOps=0;
  InputStream in=from.getInput();
  try {
    OutputStream out=to.getOutput();
    try {
      long count=copy(in,out);
      successfulOps++;
      return count;
    }
  finally {
      Closeables.close(out,successfulOps < 1);
      successfulOps++;
    }
  }
  finally {
    Closeables.close(in,successfulOps < 2);
  }
}
