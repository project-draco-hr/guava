{
  checkNonNegative("x",x);
  if (fitsInInt(x)) {
    return IntMath.sqrt((int)x,mode);
  }
  long sqrtFloor=sqrtFloor(x);
switch (mode) {
case UNNECESSARY:
    checkRoundingUnnecessary(sqrtFloor * sqrtFloor == x);
case FLOOR:
case DOWN:
  return sqrtFloor;
case CEILING:
case UP:
return (sqrtFloor * sqrtFloor == x) ? sqrtFloor : sqrtFloor + 1;
case HALF_DOWN:
case HALF_UP:
case HALF_EVEN:
long halfSquare=sqrtFloor * sqrtFloor + sqrtFloor;
return (halfSquare >= x | halfSquare < 0) ? sqrtFloor : sqrtFloor + 1;
default :
throw new AssertionError();
}
}
