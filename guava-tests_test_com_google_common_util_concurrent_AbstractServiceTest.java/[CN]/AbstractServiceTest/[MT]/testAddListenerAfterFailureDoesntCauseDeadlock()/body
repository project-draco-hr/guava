{
  final StartThrowingService service=new StartThrowingService();
  service.start();
  assertEquals(State.FAILED,service.state());
  service.addListener(new RecordingListener(),MoreExecutors.sameThreadExecutor());
  Thread thread=new Thread(){
    @Override public void run(){
      service.state();
    }
  }
;
  thread.start();
  thread.join(100);
  assertFalse(thread + " is deadlocked",thread.isAlive());
}
