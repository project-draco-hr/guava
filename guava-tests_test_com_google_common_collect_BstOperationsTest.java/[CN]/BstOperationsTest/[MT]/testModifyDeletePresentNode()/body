{
  SimpleNode a=new SimpleNode('a',null,null);
  SimpleNode b=new SimpleNode('b',a,null);
  SimpleNode g=new SimpleNode('g',null,null);
  SimpleNode f=new SimpleNode('f',null,g);
  SimpleNode d=new SimpleNode('d',b,f);
  BstNodeFactory<SimpleNode> nodeFactory=EasyMock.createStrictMock(BstNodeFactory.class);
  BstBalancePolicy<SimpleNode> balancePolicy=EasyMock.createStrictMock(BstBalancePolicy.class);
  BstModifier<Character,SimpleNode> modifier=EasyMock.createStrictMock(BstModifier.class);
  expectPossibleEntryfication(nodeFactory,a);
  expect(modifier.modify(eq('a'),withKey('a'))).andReturn(BstModificationResult.rebalancingChange(a,null));
  expect(balancePolicy.combine(same(nodeFactory),(SimpleNode)isNull(),(SimpleNode)isNull())).andReturn(null);
  expectPossibleEntryfication(nodeFactory,b);
  SimpleNode leafB=new SimpleNode('b',null,null);
  expect(balancePolicy.balance(same(nodeFactory),withKey('b'),(SimpleNode)isNull(),(SimpleNode)isNull())).andReturn(leafB);
  SimpleNode dWithLeafB=new SimpleNode('d',leafB,f);
  expectPossibleEntryfication(nodeFactory,d);
  expect(balancePolicy.balance(same(nodeFactory),withKey('d'),same(leafB),same(f))).andReturn(dWithLeafB);
  replay(nodeFactory,balancePolicy,modifier);
  BstMutationRule<Character,SimpleNode> mutationRule=BstMutationRule.createRule(modifier,balancePolicy,nodeFactory);
  BstMutationResult<Character,SimpleNode> mutationResult=BstOperations.mutate(Ordering.natural(),mutationRule,d,'a');
  assertEquals('a',mutationResult.getTargetKey().charValue());
  assertEquals('a',mutationResult.getOriginalTarget().getKey().charValue());
  assertNull(mutationResult.getChangedTarget());
  assertSame(d,mutationResult.getOriginalRoot());
  assertSame(dWithLeafB,mutationResult.getChangedRoot());
  assertEquals(ModificationType.REBALANCING_CHANGE,mutationResult.modificationType());
  verify(nodeFactory,balancePolicy,modifier);
}
