{
  SimpleNode a=new SimpleNode('a',null,null);
  SimpleNode b=new SimpleNode('b',a,null);
  SimpleNode g=new SimpleNode('g',null,null);
  SimpleNode f=new SimpleNode('f',null,g);
  SimpleNode d=new SimpleNode('d',b,f);
  BstNodeFactory<SimpleNode> nodeFactory=EasyMock.createStrictMock(BstNodeFactory.class);
  BstBalancePolicy<SimpleNode> balancePolicy=EasyMock.createStrictMock(BstBalancePolicy.class);
  BstModifier<Character,SimpleNode> modifier=EasyMock.createStrictMock(BstModifier.class);
  expectPossibleEntryfication(nodeFactory,a);
  SimpleNode a2=new SimpleNode('a',null,null);
  expect(modifier.modify(eq('a'),withKey('a'))).andReturn(BstModificationResult.rebuildingChange(a,a2));
  expectPossibleEntryfication(nodeFactory,a2);
  SimpleNode bWithA2=new SimpleNode('b',a2,null);
  expect(nodeFactory.createNode(same(b),withKey('a'),(SimpleNode)isNull())).andReturn(bWithA2);
  SimpleNode dWithA2=new SimpleNode('d',bWithA2,f);
  expect(nodeFactory.createNode(same(d),same(bWithA2),same(f))).andReturn(dWithA2);
  replay(nodeFactory,balancePolicy,modifier);
  BstMutationRule<Character,SimpleNode> mutationRule=BstMutationRule.createRule(modifier,balancePolicy,nodeFactory);
  BstMutationResult<Character,SimpleNode> mutationResult=BstOperations.mutate(Ordering.natural(),mutationRule,d,'a');
  assertEquals('a',mutationResult.getTargetKey().charValue());
  assertSame(a,mutationResult.getOriginalTarget());
  assertEquals('a',mutationResult.getChangedTarget().getKey().charValue());
  assertSame(d,mutationResult.getOriginalRoot());
  assertSame(dWithA2,mutationResult.getChangedRoot());
  assertEquals(ModificationType.REBUILDING_CHANGE,mutationResult.modificationType());
  verify(nodeFactory,balancePolicy,modifier);
}
