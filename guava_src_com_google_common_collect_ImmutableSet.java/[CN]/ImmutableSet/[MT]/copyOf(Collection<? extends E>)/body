{
  if (elements instanceof ImmutableSet && !(elements instanceof ImmutableSortedSet)) {
    @SuppressWarnings("unchecked") ImmutableSet<E> set=(ImmutableSet<E>)elements;
    if (!set.isPartialView()) {
      return set;
    }
  }
 else   if (elements instanceof EnumSet) {
    EnumSet<? extends Enum<?>> enumSet=EnumSet.copyOf((EnumSet<? extends Enum<?>>)elements);
    @SuppressWarnings("unchecked") ImmutableSet<E> result=(ImmutableSet<E>)ImmutableEnumSet.asImmutable(enumSet);
    return result;
  }
  Object[] array=elements.toArray();
  return construct(array.length,array);
}
