{
  if (map instanceof ImmutableBiMap) {
    @SuppressWarnings("unchecked") ImmutableBiMap<K,V> bimap=(ImmutableBiMap<K,V>)map;
    if (!bimap.isPartialView()) {
      return bimap;
    }
  }
  ImmutableMap<K,V> immutableMap=ImmutableMap.copyOf(map);
  if (immutableMap instanceof ImmutableBiMap) {
    return (ImmutableBiMap<K,V>)immutableMap;
  }
 else {
    return new RegularImmutableBiMap<K,V>(immutableMap);
  }
}
