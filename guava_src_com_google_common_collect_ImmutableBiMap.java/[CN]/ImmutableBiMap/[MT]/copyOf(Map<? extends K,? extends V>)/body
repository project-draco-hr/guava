{
  if (map instanceof ImmutableBiMap) {
    @SuppressWarnings("unchecked") ImmutableBiMap<K,V> bimap=(ImmutableBiMap<K,V>)map;
    if (!bimap.isPartialView()) {
      return bimap;
    }
  }
  Entry<?,?>[] entries=map.entrySet().toArray(EMPTY_ENTRY_ARRAY);
  return fromEntries(entries.length,entries);
}
