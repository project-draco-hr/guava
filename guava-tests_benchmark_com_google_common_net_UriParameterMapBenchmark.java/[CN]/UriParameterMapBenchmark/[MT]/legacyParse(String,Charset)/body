{
  checkNotNull(query);
  checkNotNull(encoding);
  UriParameterMap map=new UriParameterMap();
  if (!query.isEmpty()) {
    Iterable<String> pieces=Splitter.on('&').split(query);
    int count=0;
    for (    String piece : pieces) {
      count++;
      if (count > maxUriParameterCount) {
        throw new TooManyUriParametersException();
      }
      String[] pair=piece.split("=",2);
      String name=decodeString(pair[0],encoding);
      String value=pair.length < 2 ? "" : decodeString(pair[1],encoding);
      map.put(name,value);
    }
  }
  return map;
}
