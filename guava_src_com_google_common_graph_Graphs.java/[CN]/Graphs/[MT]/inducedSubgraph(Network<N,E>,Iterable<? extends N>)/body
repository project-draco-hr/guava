{
  NetworkBuilder<N,E> builder=NetworkBuilder.from(graph);
  if (nodes instanceof Collection) {
    builder=builder.expectedNodeCount(((Collection<?>)nodes).size());
  }
  MutableNetwork<N,E> subgraph=builder.build();
  for (  N node : nodes) {
    subgraph.addNode(node);
  }
  for (  N node : subgraph.nodes()) {
    for (    E edge : graph.outEdges(node)) {
      N otherNode=graph.incidentNodes(edge).otherNode(node);
      if (subgraph.nodes().contains(otherNode)) {
        subgraph.addEdge(edge,node,otherNode);
      }
    }
  }
  return subgraph;
}
