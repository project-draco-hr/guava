{
  NetworkBuilder<N,E> builder=NetworkBuilder.from(graph);
  if (nodes instanceof Collection) {
    builder=builder.expectedNodeCount(((Collection<?>)nodes).size());
  }
  MutableNetwork<N,E> subgraph=builder.build();
  for (  N node : nodes) {
    subgraph.addNode(node);
  }
  for (  N node : subgraph.nodes()) {
    for (    E edge : graph.outEdges(node)) {
      N adjacentNode=graph.incidentNodes(edge).adjacentNode(node);
      if (subgraph.nodes().contains(adjacentNode)) {
        subgraph.addEdge(edge,node,adjacentNode);
      }
    }
  }
  return subgraph;
}
