{
  boolean hasSameComparator=fromSortedSet || hasSameComparator(elements,comparator);
  if (hasSameComparator && (elements instanceof ImmutableSortedSet)) {
    @SuppressWarnings("unchecked") ImmutableSortedSet<E> original=(ImmutableSortedSet<E>)elements;
    if (original.isEmpty()) {
      return original;
    }
    ImmutableList<E> elementsList=original.asList();
    ImmutableList<E> copiedElementsList=ImmutableList.copyOf(elements);
    if (elementsList == copiedElementsList) {
      return original;
    }
    return new RegularImmutableSortedSet<E>(copiedElementsList,comparator);
  }
  ImmutableList<E> list=immutableSortedUniqueCopy(comparator,Lists.newArrayList(elements));
  if (list.isEmpty()) {
    return emptySet(comparator);
  }
  return new RegularImmutableSortedSet<E>(list,comparator);
}
