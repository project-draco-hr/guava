{
  FakeTicker ticker=new FakeTicker();
  CustomConcurrentHashMap<Object,Object> map=makeMap(createCacheBuilder().concurrencyLevel(1).ticker(ticker).expireAfterAccess(1,NANOSECONDS));
  Segment<Object,Object> segment=map.segments[0];
  Object key=new Object();
  Object value=new Object();
  map.put(key,value);
  ReferenceEntry<Object,Object> entry=map.getEntry(key);
  assertTrue(map.isLive(entry,ticker.read()));
  segment.accessQueue.add(entry);
  assertSame(value,map.get(key));
  assertSame(entry,segment.accessQueue.peek());
  assertEquals(1,segment.accessQueue.size());
  segment.recordRead(entry,ticker.read());
  segment.expireEntries(ticker.read());
  assertTrue(map.containsKey(key));
  assertSame(entry,segment.accessQueue.peek());
  assertEquals(1,segment.accessQueue.size());
  ticker.advance(1);
  segment.recordRead(entry,ticker.read());
  segment.expireEntries(ticker.read());
  assertTrue(map.containsKey(key));
  assertSame(entry,segment.accessQueue.peek());
  assertEquals(1,segment.accessQueue.size());
  ticker.advance(1);
  segment.recordRead(entry,ticker.read());
  segment.expireEntries(ticker.read());
  assertTrue(map.containsKey(key));
  assertSame(entry,segment.accessQueue.peek());
  assertEquals(1,segment.accessQueue.size());
  ticker.advance(1);
  segment.expireEntries(ticker.read());
  assertTrue(map.containsKey(key));
  assertSame(entry,segment.accessQueue.peek());
  assertEquals(1,segment.accessQueue.size());
  ticker.advance(1);
  assertFalse(map.containsKey(key));
  assertNull(map.get(key));
  segment.expireEntries(ticker.read());
  assertFalse(map.containsKey(key));
  assertNull(map.get(key));
  assertTrue(segment.accessQueue.isEmpty());
}
