{
  for (  boolean interruptibly : new boolean[]{true,false}) {
    assertEquals(0,Queues.drain(q,ImmutableList.of(),1,10,TimeUnit.MILLISECONDS));
    Future<?> submitter=threadPool.submit(new Producer(q,1));
    long startTime=System.nanoTime();
    int drained=drain(q,Lists.newArrayList(),2,10,TimeUnit.MILLISECONDS,interruptibly);
    assertTrue(drained <= 1);
    assertTrue((System.nanoTime() - startTime) >= TimeUnit.MILLISECONDS.toNanos(10));
    submitter.get();
    if (drained == 0) {
      assertNotNull(q.poll());
    }
  }
}
