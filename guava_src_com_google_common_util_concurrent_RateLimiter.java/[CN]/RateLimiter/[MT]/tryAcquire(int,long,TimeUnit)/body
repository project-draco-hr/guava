{
  checkPermits(permits);
  long timeoutMicros=unit.toMicros(timeout);
  long microsToWait;
synchronized (this) {
    long nowMicros=readSafeMicros();
    if (nextFreeTicketMicros > nowMicros + timeoutMicros) {
      return false;
    }
 else {
      microsToWait=reserveNextTicket(permits,nowMicros);
    }
  }
  ticker.sleepMicrosUninterruptibly(microsToWait);
  return true;
}
