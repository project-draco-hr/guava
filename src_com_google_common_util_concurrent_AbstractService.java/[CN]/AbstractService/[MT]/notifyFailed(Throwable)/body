{
  checkNotNull(cause);
  lock.lock();
  try {
    if (state == State.STARTING) {
      startup.setException(cause);
      shutdown.setException(new Exception("Service failed to start.",cause));
    }
 else     if (state == State.STOPPING) {
      shutdown.setException(cause);
    }
    state=State.FAILED;
  }
  finally {
    lock.unlock();
  }
}
