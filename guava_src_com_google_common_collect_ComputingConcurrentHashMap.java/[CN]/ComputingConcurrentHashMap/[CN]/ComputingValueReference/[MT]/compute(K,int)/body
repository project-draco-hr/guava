{
  V value;
  try {
    value=map.computingFunction.apply(key);
  }
 catch (  ComputationException e) {
    setValueReference(new ComputationExceptionReference<K,V>(e.getCause()));
    throw e;
  }
catch (  Throwable t) {
    setValueReference(new ComputationExceptionReference<K,V>(t));
    throw new ComputationException(t);
  }
  setValueReference(new ComputedReference<K,V>(value));
  if (value != null) {
    map.segmentFor(hash).put(key,hash,value,true);
  }
  return value;
}
