{
  final MyException sameInstance=new MyException();
  SettableFuture<Object> firstFuture=SettableFuture.create();
  final SettableFuture<Object> secondFuture=SettableFuture.create();
  ListenableFuture<List<Object>> bulkFuture=allAsList(firstFuture,secondFuture);
  bulkFuture.addListener(new Runnable(){
    @Override public void run(){
      secondFuture.setException(sameInstance);
    }
  }
,directExecutor());
  firstFuture.setException(sameInstance);
  try {
    bulkFuture.get();
    fail();
  }
 catch (  ExecutionException expected) {
    assertTrue(expected.getCause() instanceof MyException);
    assertEquals(1,combinedFutureLogHandler.getStoredLogRecords().size());
  }
}
