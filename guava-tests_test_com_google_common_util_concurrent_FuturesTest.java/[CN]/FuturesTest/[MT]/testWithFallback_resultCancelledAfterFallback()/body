{
  final SettableFuture<Integer> secondary=SettableFuture.create();
  final RuntimeException raisedException=new RuntimeException();
  FutureFallbackSpy<Integer> fallback=spy(new FutureFallback<Integer>(){
    @Override public ListenableFuture<Integer> create(    Throwable t) throws Exception {
      assertThat(t).isSameAs(raisedException);
      return secondary;
    }
  }
);
  ListenableFuture<Integer> failingFuture=Futures.immediateFailedFuture(raisedException);
  ListenableFuture<Integer> derived=Futures.withFallback(failingFuture,fallback);
  derived.cancel(false);
  assertTrue(secondary.isCancelled());
  assertFalse(secondary.wasInterrupted());
  fallback.verifyCallCount(1);
}
