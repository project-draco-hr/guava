{
  final AtomicBoolean functionCalled=new AtomicBoolean();
  AsyncFunction<String,Integer> function=new AsyncFunction<String,Integer>(){
    @Override public ListenableFuture<Integer> apply(    String input) throws Exception {
      functionCalled.set(true);
      return Futures.immediateFuture(1);
    }
  }
;
  SettableFuture<String> inputFuture=SettableFuture.create();
  ExecutorService executor=newSingleThreadExecutor();
  ListenableFuture<Integer> future=Futures.transform(inputFuture,function,executor);
  final CountDownLatch beforeFunction=new CountDownLatch(1);
  executor.submit(new Runnable(){
    @Override public void run(){
      awaitUninterruptibly(beforeFunction);
    }
  }
);
  inputFuture.set("value");
  future.cancel(false);
  beforeFunction.countDown();
  executor.awaitTermination(5,TimeUnit.SECONDS);
  assertFalse(functionCalled.get());
}
