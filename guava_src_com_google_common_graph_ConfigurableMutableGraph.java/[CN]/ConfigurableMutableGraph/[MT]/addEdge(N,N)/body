{
  checkNotNull(nodeA,"nodeA");
  checkNotNull(nodeB,"nodeB");
  boolean isSelfLoop=nodeA.equals(nodeB);
  if (!allowsSelfLoops()) {
    checkArgument(!isSelfLoop,SELF_LOOPS_NOT_ALLOWED,nodeA);
  }
  NodeAdjacencies<N> connectionsA=nodeConnections.get(nodeA);
  NodeAdjacencies<N> connectionsB=nodeConnections.get(nodeB);
  if (connectionsA != null && connectionsB != null && connectionsA.successors().contains(nodeB)) {
    return false;
  }
  if (connectionsA == null) {
    connectionsA=addNodeInternal(nodeA);
  }
  connectionsA.addSuccessor(nodeB);
  if (connectionsB == null) {
    connectionsB=isSelfLoop ? connectionsA : addNodeInternal(nodeB);
  }
  connectionsB.addPredecessor(nodeA);
  return true;
}
