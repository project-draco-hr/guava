{
  ThrowOnStartUpService service=new ThrowOnStartUpService();
  assertFalse(service.startUpCalled);
  service.startAsync();
  try {
    service.awaitRunning();
    fail();
  }
 catch (  IllegalStateException expected) {
    assertEquals("kaboom!",expected.getCause().getMessage());
  }
  executionThread.join();
  assertTrue(service.startUpCalled);
  assertEquals(Service.State.FAILED,service.state());
  assertTrue(thrownByExecutionThread.getMessage().equals("kaboom!"));
}
