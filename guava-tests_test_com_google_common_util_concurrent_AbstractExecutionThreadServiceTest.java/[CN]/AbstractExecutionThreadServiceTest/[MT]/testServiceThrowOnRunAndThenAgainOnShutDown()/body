{
  ThrowOnRunService service=new ThrowOnRunService();
  service.throwOnShutDown=true;
  service.startAsync();
  try {
    service.awaitTerminated();
    fail();
  }
 catch (  IllegalStateException expected) {
    executionThread.join();
    assertEquals(thrownByExecutionThread,expected.getCause());
  }
  assertTrue(service.shutDownCalled);
  assertEquals(Service.State.FAILED,service.state());
  assertEquals("kaboom!",thrownByExecutionThread.getMessage());
}
