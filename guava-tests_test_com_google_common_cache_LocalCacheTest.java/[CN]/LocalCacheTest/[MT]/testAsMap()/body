{
  CacheBuilder<Object,Object> builder=createCacheBuilder();
  LocalCache<Object,Object> cache=makeCache(builder,identityLoader());
  assertEquals(EMPTY_STATS,cache.stats());
  Object one=new Object();
  Object two=new Object();
  Object three=new Object();
  ConcurrentMap<Object,Object> map=cache.asMap();
  assertNull(map.put(one,two));
  assertSame(two,map.get(one));
  map.putAll(ImmutableMap.of(two,three));
  assertSame(three,map.get(two));
  assertSame(two,map.putIfAbsent(one,three));
  assertSame(two,map.get(one));
  assertNull(map.putIfAbsent(three,one));
  assertSame(one,map.get(three));
  assertSame(two,map.replace(one,three));
  assertSame(three,map.get(one));
  assertFalse(map.replace(one,two,three));
  assertSame(three,map.get(one));
  assertTrue(map.replace(one,three,two));
  assertSame(two,map.get(one));
  assertEquals(3,map.size());
  map.clear();
  assertTrue(map.isEmpty());
  assertEquals(0,map.size());
  cache.getUnchecked(one);
  assertEquals(1,map.size());
  assertSame(one,map.get(one));
  assertTrue(map.containsKey(one));
  assertTrue(map.containsValue(one));
  assertSame(one,map.remove(one));
  assertEquals(0,map.size());
  cache.getUnchecked(one);
  assertEquals(1,map.size());
  assertFalse(map.remove(one,two));
  assertTrue(map.remove(one,one));
  assertEquals(0,map.size());
  cache.getUnchecked(one);
  Map<Object,Object> newMap=ImmutableMap.of(one,one);
  assertEquals(newMap,map);
  assertEquals(newMap.entrySet(),map.entrySet());
  assertEquals(newMap.keySet(),map.keySet());
  Set<Object> expectedValues=ImmutableSet.of(one);
  Set<Object> actualValues=ImmutableSet.copyOf(map.values());
  assertEquals(expectedValues,actualValues);
}
