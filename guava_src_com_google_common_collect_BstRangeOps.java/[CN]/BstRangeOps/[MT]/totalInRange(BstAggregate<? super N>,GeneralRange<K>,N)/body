{
  checkNotNull(aggregate);
  checkNotNull(range);
  if (root == null || range.isEmpty()) {
    return 0;
  }
  int total=aggregate.treeValue(root);
  if (range.hasLowerBound()) {
    total-=totalTooLow(aggregate,range,root);
  }
  if (range.hasUpperBound()) {
    total-=totalTooHigh(aggregate,range,root);
  }
  return total;
}
