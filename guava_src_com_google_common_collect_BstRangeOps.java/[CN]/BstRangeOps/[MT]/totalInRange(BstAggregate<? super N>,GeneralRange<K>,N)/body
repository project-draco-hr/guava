{
  checkNotNull(aggregate);
  checkNotNull(range);
  if (root == null || range.isEmpty()) {
    return 0;
  }
  long total=aggregate.treeValue(root);
  if (range.hasLowerBound()) {
    total-=totalBeyondRangeToSide(aggregate,range,LEFT,root);
  }
  if (range.hasUpperBound()) {
    total-=totalBeyondRangeToSide(aggregate,range,RIGHT,root);
  }
  return total;
}
