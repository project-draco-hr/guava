{
  if ((map instanceof ImmutableMap) && !(map instanceof ImmutableSortedMap)) {
    @SuppressWarnings("unchecked") ImmutableMap<K,V> kvMap=(ImmutableMap<K,V>)map;
    if (!kvMap.isPartialView()) {
      return kvMap;
    }
  }
 else   if (map instanceof EnumMap) {
    return copyOfEnumMapUnsafe(map);
  }
  return copyOf(map.entrySet());
}
