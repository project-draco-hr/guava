{
  if (unfiltered instanceof SortedMap) {
    return filterKeys((SortedMap<K,V>)unfiltered,keyPredicate);
  }
  checkNotNull(keyPredicate);
  Predicate<Entry<K,V>> entryPredicate=new Predicate<Entry<K,V>>(){
    @Override public boolean apply(    Entry<K,V> input){
      return keyPredicate.apply(input.getKey());
    }
  }
;
  return (unfiltered instanceof AbstractFilteredMap) ? filterFiltered((AbstractFilteredMap<K,V>)unfiltered,entryPredicate) : new FilteredKeyMap<K,V>(checkNotNull(unfiltered),keyPredicate,entryPredicate);
}
