{
  ImmutableList<Service> copy=ImmutableList.copyOf(services);
  this.state=new ServiceManagerState(copy.size());
  ImmutableMap.Builder<Service,ServiceListener> builder=ImmutableMap.builder();
  Executor executor=MoreExecutors.sameThreadExecutor();
  for (  Service service : copy) {
    ServiceListener listener=new ServiceListener(service,state);
    service.addListener(listener,executor);
    checkArgument(service.state() == State.NEW,"Can only manage NEW services, %s",service);
    builder.put(service,listener);
  }
  this.services=builder.build();
}
